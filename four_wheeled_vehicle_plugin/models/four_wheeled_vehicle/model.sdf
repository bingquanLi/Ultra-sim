<?xml version="1.0" ?>
<sdf version='1.7'>
    <model name='four_wheeled_vehicle'>
        <pose>0 0 1.0 0 0 0</pose>
        <link name='base_link'>
        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>2000</mass>
            <inertia>
                <ixx>1200</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>2500</iyy>
                <iyz>0</iyz>
                <izz>3000</izz>
            </inertia>
        </inertial>

        <collision name='base_link_collision'>
            <pose>0 0 0.12 0 0 0</pose>
            <geometry>
                <box>
                    <size>5.0 1.5 0.47</size>
                </box>
            </geometry>
        </collision>

        <visual name='base_link_visual'>
            <pose>0 0 0 0 0 0</pose>
            <geometry>
                <mesh>
                    <uri>model://four_wheeled_vehicle/meshes/car.dae</uri>
                    <scale>1 1 1</scale>
                </mesh>
            </geometry>
        </visual>
        </link>

        <joint name='front_left_steering_joint' type='revolute'>
            <pose relative_to='base_link'>1.445 0.833 -0.024 0 0 0</pose>
            <parent>base_link</parent>
            <child>front_left_steering_link</child>

            <axis>
                <xyz>0 0 1</xyz>


                <limit>
                    <lower>-0.6</lower>
                    <upper>0.6</upper>
                    <effort>1e+06</effort>
                    <velocity>10000</velocity>
                </limit>

                <dynamics>
                    <damping>10</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>

        <link name='front_left_steering_link'>
        <pose relative_to='front_left_steering_joint'>0 0 0 0 0 0</pose>

        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>5</mass>
            <inertia>
                <ixx>0.012</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.025</iyy>
                <iyz>0</iyz>
                <izz>0.012</izz>
            </inertia>
        </inertial>

        <visual name='front_left_steering_link_visual'>
            <pose>0 0 0 1.5708 0 0</pose>
            <geometry>
                <cylinder>
                    <length>0.01</length>
                    <radius>0.1</radius>
                </cylinder>
            </geometry>
        </visual>
        </link>

        <joint name='front_left_wheel_joint' type='revolute'>
            <pose relative_to='front_left_steering_link'>0 0 0 0 0 0</pose>
            <parent>front_left_steering_link</parent>
            <child>front_left_wheel_link</child>

            <axis>
                <xyz>0 1 0</xyz>

                <limit>
                    <effort>0</effort>
                    <velocity>0</velocity>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>

                <dynamics>
                    <damping>10.0</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>

        <link name='front_left_wheel_link'>
        <pose relative_to='front_left_wheel_joint'>0 0 0 0 0 0</pose>

        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>40</mass>
            <inertia>
                <ixx>1.4</ixx>
                <iyy>2.5</iyy>
                <izz>1.4</izz>
            </inertia>
        </inertial>

        <collision name='front_left_wheel_link_collision'>
            <pose>0 0 0 1.5708 0 0</pose>
            <geometry>
                <cylinder>
                    <length>0.35</length>
                    <radius>0.35</radius>
                </cylinder>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>2.0</mu>
                        <mu2>1.5</mu2>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
            </surface>
        </collision>

        <visual name='front_left_wheel_link_visual'>
            <pose>0 0 0 0 0 0</pose>
            <geometry>
                <mesh>
                    <uri>model://four_wheeled_vehicle/meshes/wheel_l.dae</uri>
                    <scale>1 1 1</scale>
                </mesh>
            </geometry>
        </visual>
        </link>

        <joint name='front_right_steering_joint' type='revolute'>
            <pose relative_to='base_link'>1.445 -0.833 -0.024 0 0 0</pose>
            <parent>base_link</parent>
            <child>front_right_steering_link</child>

            <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-0.6</lower>
                    <upper>0.6</upper>
                    <effort>1e+06</effort>
                    <velocity>10000</velocity>
                </limit>

                <dynamics>
                    <damping>10</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>

        <link name='front_right_steering_link'>
        <pose relative_to='front_right_steering_joint'>0 0 0 0 0 0</pose>

        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>5</mass>
            <inertia>
                <ixx>0.012</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.025</iyy>
                <iyz>0</iyz>
                <izz>0.012</izz>
            </inertia>
        </inertial>

        <visual name='front_right_steering_link_visual'>
            <pose>0 0 0 1.5708 0 0</pose>
            <geometry>
                <cylinder>
                    <length>0.01</length>
                    <radius>0.1</radius>
                </cylinder>
            </geometry>
        </visual>
        </link>

        <joint name='front_right_wheel_joint' type='revolute'>
            <pose relative_to='front_right_steering_link'>0 0 0 0 0 0</pose>
            <parent>front_right_steering_link</parent>
            <child>front_right_wheel_link</child>

            <axis>
                <xyz>0 1 0</xyz>

                <limit>
                    <effort>0</effort>
                    <velocity>0</velocity>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>

                <dynamics>
                    <damping>10.0</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>


        <link name='front_right_wheel_link'>
        <pose relative_to='front_right_wheel_joint'>0 0 0 0 0 0</pose>

        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>40</mass>
            <inertia>
                <ixx>1.4</ixx>
                <iyy>2.5</iyy>
                <izz>1.4</izz>
            </inertia>
        </inertial>

        <collision name='front_right_wheel_link_collision'>
            <pose>0 0 0 1.5708 0 0</pose>
            <geometry>
                <cylinder>
                    <length>0.35</length>
                    <radius>0.35</radius>
                </cylinder>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>2.0</mu>
                        <mu2>1.5</mu2>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
            </surface>
        </collision>

        <visual name='front_right_wheel_link_visual'>
            <pose>0 0 0 0 0 0</pose>
            <geometry>
                <mesh>
                    <uri>model://four_wheeled_vehicle/meshes/wheel_r.dae</uri>
                    <scale>1 1 1</scale>
                </mesh>
            </geometry>
        </visual>
        </link>

        <joint name='rear_left_wheel_joint' type='revolute'>
            <pose relative_to='base_link'>-1.545 0.833 -0.024 0 0 0</pose>
            <parent>base_link</parent>
            <child>rear_left_wheel_link</child>

            <axis>
                <xyz>0 1 0</xyz>

                <limit>
                    <effort>5000</effort>
                    <velocity>10000</velocity>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>

                <dynamics>
                    <damping>10.0</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>

        <link name='rear_left_wheel_link'>

        <pose relative_to='rear_left_wheel_joint'>0 0 0 0 0 0</pose>

        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>40</mass>
            <inertia>
                <ixx>1.4</ixx>
                <iyy>2.5</iyy>
                <izz>1.4</izz>
            </inertia>
        </inertial>

        <collision name='rear_left_wheel_link_collision'>
            <pose>0 0 0 1.5708 0 0</pose>
            <geometry>
                <cylinder>
                    <length>0.35</length>
                    <radius>0.35</radius>
                </cylinder>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>2.0</mu>
                        <mu2>1.5</mu2>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
            </surface>
        </collision>

        <visual name='rear_left_wheel_link_visual'>
            <pose>0 0 0 0 0 0</pose>
            <geometry>
                <mesh>
                    <uri>model://four_wheeled_vehicle/meshes/wheel_l.dae</uri>
                    <scale>1 1 1</scale>
                </mesh>
            </geometry>
        </visual>
        </link>

        <joint name='rear_right_wheel_joint' type='revolute'>
            <pose relative_to='base_link'>-1.545 -0.833 -0.024 0 0 0</pose>
            <parent>base_link</parent>
            <child>rear_right_wheel_link</child>

            <axis>
                <xyz>0 1 0</xyz>

                <limit>
                    <effort>5000</effort>
                    <velocity>10000</velocity>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>


                <dynamics>
                    <damping>10.0</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>


        <link name='rear_right_wheel_link'>

        <pose relative_to='rear_right_wheel_joint'>0 0 0 0 0 0</pose>

        <inertial>
            <pose>0 0 0 0 0 0</pose>
            <mass>40</mass>
            <inertia>
                <ixx>1.4</ixx>
                <iyy>2.5</iyy>
                <izz>1.4</izz>
            </inertia>
        </inertial>


        <collision name='rear_right_wheel_link_collision'>
            <pose>0 0 0 1.5708 0 0</pose>
            <geometry>
                <cylinder>
                    <length>0.35</length>
                    <radius>0.35</radius>
                </cylinder>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>2.0</mu>
                        <mu2>1.5</mu2>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
            </surface>
        </collision>


        <visual name='rear_right_wheel_link_visual'>
            <pose>0 0 0 0 0 0</pose>
            <geometry>
                <mesh>
                    <uri>model://four_wheeled_vehicle/meshes/wheel_r.dae</uri>
                    <scale>1 1 1</scale>
                </mesh>
            </geometry>
        </visual>
        </link>


        <frame name='inertial_joint' attached_to='base_link'>
            <pose>0 0 0 0 0 0</pose>
        </frame>

        <frame name='main_mass' attached_to='inertial_joint' />


        <plugin name="vehicle_controller" filename="libfour_wheeled_vehicle_plugin.so">
            <ros>
                <namespace>/vehicle</namespace>
                <command_topic>vehicle_cmd</command_topic>
                <status_topic>vehicle_status</status_topic>
                <wheelbase>3.0</wheelbase>
                <track_width>1.666</track_width>
                <wheel_radius>0.3</wheel_radius>
                <max_speed>20.0</max_speed>
                <max_steering_angle>0.6</max_steering_angle>
            </ros>
        </plugin>
        <!-- 这里加 TF 广播插件 -->
        <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
        <ros>
            <namespace>/vehicle</namespace>
        </ros>
        <joint_name>front_left_steering_joint</joint_name>
        <joint_name>front_right_steering_joint</joint_name>
        <joint_name>front_left_wheel_joint</joint_name>
        <joint_name>front_right_wheel_joint</joint_name>
        <joint_name>rear_left_wheel_joint</joint_name>
        <joint_name>rear_right_wheel_joint</joint_name>
        </plugin>



    <!-- 相机挂载 Joint -->
    <joint name="kinect_joint" type="fixed">
      <parent>base_link</parent>
      <child>kinect_link</child>
      <pose>0.15 0 1.0 0 0 0</pose>
    </joint>  
    <!-- 相机 Link -->
    <link name="kinect_link">
      <pose>0.15 0 1.0 0 0 0</pose> <!-- 根据需求调整位置 -->
      <inertial>
        <mass>0.1</mass>
      </inertial>

      <collision name="collision">
        <geometry>
          <box>
            <size>0.073 0.276 0.072</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <geometry>
          <mesh>
            <uri>model://kinect/meshes/kinect.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <sensor name="kinect_camera" type="depth">
        <always_on>true</always_on>
        <update_rate>15</update_rate>
        <visualize>true</visualize>
        <pose>0 0 0 0 0 0</pose>
        <camera>
          <horizontal_fov>1.047198</horizontal_fov>
          <image>
            <width>640</width>
            <height>480</height>
            <format>R8G8B8</format>
          </image>
          <depth>
            <width>640</width>
            <height>480</height>
            <format>R8G8B8</format>
          </depth>
          <clip>
            <near>0.03</near>
            <far>100.0</far>
          </clip>
        </camera>

        <plugin name="camera_driver" filename="libgazebo_ros_camera.so">
          <ros>
            <namespace>/kinect</namespace>
          </ros>
          <camera_name>kinect</camera_name>
          <frame_name>kinect_link</frame_name>
          <image_topic>color/image_raw</image_topic>
          <depth_camera>true</depth_camera>
          <depth_image_topic>depth/image_raw</depth_image_topic>
          <point_cloud_topic>depth/points</point_cloud_topic>
          <publish_tf>true</publish_tf> <!-- 确保发布 TF -->
        </plugin>
      </sensor>
    </link>

    </model>
</sdf>